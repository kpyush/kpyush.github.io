<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Serial API Example</title>
</head>
<body>
    <button id="sendButton">Send "a"</button>
    <div id="serialOutput"></div>

    <script>
        async function init() {
            const port = await navigator.serial.requestPort();

            await port.open({ baudRate: 9600 });

            document.getElementById('sendButton').addEventListener('click', () => {
                sendCharacter(port, 'a');
            });

            readData(port);
        }

        async function sendCharacter(port, char) {
            const writer = port.writable.getWriter();
            await writer.write(new TextEncoder().encode(char));
            writer.releaseLock();
        }

        async function readData(port) {
            const reader = port.readable.getReader();

            while (true) {
                const { value, done } = await reader.read();

                if (done) {
                    reader.releaseLock();
                    break;
                }

                const receivedChar = new TextDecoder().decode(value);
                document.getElementById('serialOutput').textContent += receivedChar;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            navigator.serial.addEventListener('connect', init);
            navigator.serial.addEventListener('disconnect', () => location.reload());
        });
    </script>
</body>
</html>
